Menu="Utilities"
Title="DriveAge"
Icon="icon.png"
---
<?PHP
/* DriveAge Plugin - Dashboard */
require_once '/usr/local/emhttp/plugins/driveage/include/config.php';
require_once '/usr/local/emhttp/plugins/driveage/include/helpers.php';

$config = loadConfig();
$timestamp = date('Y-m-d H:i:s');
?>
<link rel="stylesheet" href="/plugins/driveage/styles/driveage.css">
<script src="/plugins/driveage/js/dashboard.js"></script>

<div class="driveage-container">
    <div class="driveage-header">
        <div>
            <h2>DriveAge - Dashboard</h2>
            <span id="last-updated" class="last-updated">Loading...</span>
        </div>
        <div class="driveage-controls">
            <button id="refresh-btn" title="Refresh drive data">
                <span>↻</span> Refresh
            </button>
            <button onclick="window.location.href='/Settings/DriveAgeSettings'" title="Plugin settings">⚙ Settings</button>
        </div>
    </div>

    <!-- Loading indicator -->
    <div id="loading-indicator" class="loading">
        <div>Loading drive data...</div>
    </div>

    <!-- Error message container -->
    <div id="error-message" class="error-message" style="display:none;"></div>

    <!-- Drive data container (will be populated by JavaScript) -->
    <div id="drive-container"></div>

    <div style="background: #e8f5e9; padding: 20px; margin: 20px 0; border-radius: 5px;">
        <h3>Step 3: JavaScript Test</h3>
        <p>If you see drive data above (or an error message), JavaScript is working.</p>
        <p>The dashboard.js file should load drive data via AJAX.</p>
        <p id="js-test">JavaScript NOT running</p>
    </div>
</div>

<script>
// Inline test to verify JavaScript execution
console.log('DriveAge: Inline script running');
document.getElementById('js-test').textContent = 'JavaScript IS running!';
document.getElementById('js-test').style.color = 'green';
document.getElementById('js-test').style.fontWeight = 'bold';

// Try to manually initialize if DOMContentLoaded already fired
console.log('DriveAge: Attempting to load drive data...');
setTimeout(function() {
    if (typeof initializeDashboard === 'function') {
        console.log('DriveAge: initializeDashboard found, calling it');
        initializeDashboard();
    } else {
        console.error('DriveAge: initializeDashboard function not found');
        document.getElementById('last-updated').textContent = 'Error: dashboard.js not loaded';
    }
}, 100);
</script>
